<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>چیت شیت‌ها</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Vazirmatn", "Tahoma", "Arial", sans-serif;
        background-color: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
        line-height: 1.6;
        padding: 20px;
        direction: rtl;
        margin: 0;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--vscode-panel-border);
      }

      .header h1 {
        font-size: 2rem;
        font-weight: 600;
        color: #007acc;
        margin-bottom: 10px;
      }

      .header p {
        color: var(--vscode-descriptionForeground);
        font-size: 1.1rem;
      }

      .loading,
      .error {
        text-align: center;
        padding: 60px 20px;
        font-size: 1.1rem;
      }

      .loading {
        color: var(--vscode-descriptionForeground);
      }

      .error {
        color: #dc3545;
      }

      .retry-button {
        background: #007acc;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 15px;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .retry-button:hover {
        background: #005a9e;
      }

      .back-button {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 20px;
        font-size: 14px;
        transition: all 0.2s;
      }

      .back-button:hover {
        background: var(--vscode-button-hoverBackground);
      }

      .cheat-sheets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .cheat-sheet-card {
        background: var(--vscode-editor-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 8px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .cheat-sheet-card:hover {
        background: var(--vscode-list-hoverBackground);
        border-color: #007acc;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .card-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--vscode-textPreformat-foreground);
      }

      .card-description {
        color: var(--vscode-descriptionForeground);
        margin-bottom: 12px;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        font-size: 0.85rem;
      }

      .card-category {
        background: #007acc;
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .card-count {
        color: var(--vscode-descriptionForeground);
      }

      .cheat-sheet-detail {
        display: none;
      }

      .detail-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--vscode-panel-border);
      }

      .detail-title {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--vscode-textPreformat-foreground);
      }

      .detail-description {
        color: var(--vscode-descriptionForeground);
        font-size: 1.1rem;
      }

      .items-container {
        display: grid;
        gap: 20px;
      }

      .item-card {
        background: var(--vscode-editor-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 8px;
        padding: 20px;
        transition: all 0.2s ease;
      }

      .item-card:hover {
        border-color: #007acc;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .item-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--vscode-textPreformat-foreground);
      }

      .item-content {
        color: var(--vscode-descriptionForeground);
        margin-bottom: 15px;
        line-height: 1.6;
      }

      .code-block {
        position: relative;
        background: var(--vscode-textCodeBlock-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 6px;
        padding: 15px;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        color: var(--vscode-textPreformat-foreground);
        direction: ltr;
        text-align: left;
        overflow-x: auto;
      }

      .copy-button {
        position: absolute;
        top: 10px;
        left: 10px;
        background: #007acc;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        opacity: 0;
        transition: all 0.2s;
      }

      .code-block:hover .copy-button {
        opacity: 1;
      }

      .copy-button:hover {
        background: #005a9e;
      }

      .copy-button.copied {
        background: #28a745;
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--vscode-descriptionForeground);
      }

      .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .cheat-sheets-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .header h1 {
          font-size: 1.6rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>📚 چیت شیت‌ها</h1>
        <p>مجموعه‌ای از چیت شیت‌های مفید برای توسعه‌دهندگان</p>
      </div>

      <div id="loadingSection" class="loading">
        <div>در حال بارگذاری چیت شیت‌ها...</div>
      </div>

      <div id="errorSection" class="error" style="display: none">
        <div>❌ خطا در بارگذاری چیت شیت‌ها</div>
        <div id="errorMessage"></div>
        <button class="retry-button" onclick="loadCheatSheets()">
          تلاش مجدد
        </button>
      </div>

      <div id="cheatSheetsSection" style="display: none">
        <div id="cheatSheetsGrid" class="cheat-sheets-grid">
          <!-- Cheat sheets will be populated here -->
        </div>
      </div>

      <div id="cheatSheetDetail" class="cheat-sheet-detail">
        <button class="back-button" onclick="showCheatSheetsList()">
          ← بازگشت به لیست
        </button>
        <div class="detail-header">
          <div id="detailTitle" class="detail-title"></div>
          <div id="detailDescription" class="detail-description"></div>
        </div>
        <div id="itemsContainer" class="items-container">
          <!-- Items will be populated here -->
        </div>
      </div>
    </div>

    <script>
      let cheatSheetsData = [];

      async function loadCheatSheets() {
        try {
          showLoading();

          const response = await fetch(
            "https://console.helpix.app/api/v1/cheat-sheets"
          );

          if (!response.ok) {
            throw new Error("خطا در دریافت داده‌ها: " + response.status);
          }

          const result = await response.json();

          if (result.success && result.data && result.data.data) {
            cheatSheetsData = result.data.data;
            displayCheatSheets(cheatSheetsData);
          } else {
            throw new Error("پاسخ نامعتبر از سرور");
          }
        } catch (error) {
          showError(error.message);
          console.error("Error loading cheat sheets:", error);
        }
      }

      function showLoading() {
        document.getElementById("loadingSection").style.display = "block";
        document.getElementById("errorSection").style.display = "none";
        document.getElementById("cheatSheetsSection").style.display = "none";
        document.getElementById("cheatSheetDetail").style.display = "none";
      }

      function showError(message) {
        document.getElementById("loadingSection").style.display = "none";
        document.getElementById("errorSection").style.display = "block";
        document.getElementById("cheatSheetsSection").style.display = "none";
        document.getElementById("cheatSheetDetail").style.display = "none";
        document.getElementById("errorMessage").textContent = message;
      }

      function displayCheatSheets(cheatSheets) {
        document.getElementById("loadingSection").style.display = "none";
        document.getElementById("errorSection").style.display = "none";
        document.getElementById("cheatSheetsSection").style.display = "block";
        document.getElementById("cheatSheetDetail").style.display = "none";

        const grid = document.getElementById("cheatSheetsGrid");
        grid.innerHTML = "";

        cheatSheets.forEach((cheatSheet) => {
          const card = document.createElement("div");
          card.className = "cheat-sheet-card";
          card.onclick = () => showCheatSheetDetail(cheatSheet);

          const itemCount = cheatSheet.items ? cheatSheet.items.length : 0;

          card.innerHTML = `
                    <div class="card-title">${escapeHtml(
                      cheatSheet.title
                    )}</div>
                    <div class="card-description">${escapeHtml(
                      cheatSheet.description
                    )}</div>
                    <div class="card-meta">
                        <span class="card-category">${escapeHtml(
                          cheatSheet.category
                        )}</span>
                        <span class="card-count">${itemCount} آیتم</span>
                    </div>
                `;

          grid.appendChild(card);
        });
      }

      function showCheatSheetDetail(cheatSheet) {
        document.getElementById("cheatSheetsSection").style.display = "none";
        document.getElementById("cheatSheetDetail").style.display = "block";

        document.getElementById("detailTitle").textContent = cheatSheet.title;
        document.getElementById("detailDescription").textContent =
          cheatSheet.description;

        const itemsContainer = document.getElementById("itemsContainer");
        itemsContainer.innerHTML = "";

        if (cheatSheet.items && cheatSheet.items.length > 0) {
          cheatSheet.items
            .sort((a, b) => a.order_index - b.order_index)
            .forEach((item) => {
              const itemCard = document.createElement("div");
              itemCard.className = "item-card";

              let codeHtml = "";
              if (item.code_example) {
                const safeCode = escapeHtml(item.code_example);
                codeHtml = `
                                <div class="code-block">
                                    <button class="copy-button" onclick="copyCode(this, '${safeCode.replace(
                                      /'/g,
                                      "\\'"
                                    )}')" title="کپی کردن کد">کپی</button>
                                    <pre>${safeCode}</pre>
                                </div>
                            `;
              }

              itemCard.innerHTML = `
                            <div class="item-title">${escapeHtml(
                              item.title
                            )}</div>
                            <div class="item-content">${escapeHtml(
                              item.content
                            )}</div>
                            ${codeHtml}
                        `;

              itemsContainer.appendChild(itemCard);
            });
        } else {
          itemsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📄</div>
                        <div>هیچ آیتمی برای این چیت شیت موجود نیست.</div>
                    </div>
                `;
        }
      }

      function showCheatSheetsList() {
        document.getElementById("cheatSheetDetail").style.display = "none";
        document.getElementById("cheatSheetsSection").style.display = "block";
      }

      async function copyCode(button, code) {
        try {
          await navigator.clipboard.writeText(code);
          const originalText = button.textContent;
          button.textContent = "✓ کپی شد";
          button.classList.add("copied");

          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove("copied");
          }, 2000);
        } catch (err) {
          console.error("Failed to copy: ", err);
          button.textContent = "❌ خطا";
          setTimeout(() => {
            button.textContent = "کپی";
          }, 2000);
        }
      }

      function escapeHtml(text) {
        if (!text) return "";
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          const detailSection = document.getElementById("cheatSheetDetail");
          if (detailSection.style.display === "block") {
            showCheatSheetsList();
          }
        }
      });

      // Load cheat sheets when page loads
      window.addEventListener("load", loadCheatSheets);
    </script>
  </body>
</html>
